KEEP.initUtils=()=>{KEEP.utils={html_root_dom:document.querySelector("html"),pageContainer_dom:document.querySelector(".page-container"),pageTop_dom:document.querySelector(".page-main-content-top"),firstScreen_dom:document.querySelector(".first-screen-container"),scrollProgressBar_dom:document.querySelector(".scroll-progress-bar"),pjaxProgressBar_dom:document.querySelector(".pjax-progress-bar"),pjaxProgressIcon_dom:document.querySelector(".pjax-progress-icon"),back2TopButton_dom:document.querySelector(".tool-scroll-to-top"),headerWrapper_dom:document.querySelector(".header-wrapper"),innerHeight:window.innerHeight,pjaxProgressBarTimer:null,prevScrollValue:0,fontSizeLevel:0,isHasScrollProgressBar:!1,isHasScrollPercent:!1,isHeaderTransparent:!1,hasToc:!1,initData(){const{scroll:e,first_screen:t}=KEEP.theme_config.style;this.isHasScrollProgressBar=!0===e.progress_bar,this.isHasScrollPercent=!0===e.percent;const{enable:o,header_transparent:s}=t;this.isHeaderTransparent=!0===o&&!0===s},styleHandleWhenScroll(){const e=document.body.scrollTop||document.documentElement.scrollTop,t=document.body.scrollHeight||document.documentElement.scrollHeight,o=window.innerHeight||document.documentElement.clientHeight,s=Math.round(e/(t-o)*100);if(this.isHasScrollProgressBar){const r=(e/(t-o)*100).toFixed(3);this.scrollProgressBar_dom.style.visibility=0===s?"hidden":"visible",this.scrollProgressBar_dom.style.width=`${r}%`}if(this.isHasScrollPercent){const e=this.back2TopButton_dom.querySelector(".percent");0===s||void 0===s?this.back2TopButton_dom.classList.remove("show"):(this.back2TopButton_dom.classList.add("show"),e.innerHTML=s.toFixed(0))}e>this.prevScrollValue&&e>this.innerHeight?(this.pageTop_dom.classList.add("hide"),this.isHeaderTransparent&&this.headerWrapper_dom.classList.remove("transparent-1","transparent-2")):(this.pageTop_dom.classList.remove("hide"),this.isHeaderTransparent&&(e<=this.headerWrapper_dom.getBoundingClientRect().height?(this.headerWrapper_dom.classList.remove("transparent-2"),this.headerWrapper_dom.classList.add("transparent-1")):e<this.innerHeight&&this.headerWrapper_dom.classList.add("transparent-2"))),this.prevScrollValue=e},registerWindowScroll(){window.addEventListener("scroll",(()=>{this.styleHandleWhenScroll(),KEEP.theme_config.toc.enable&&KEEP.utils.hasOwnProperty("findActiveIndexByTOC")&&KEEP.utils.findActiveIndexByTOC(),KEEP.utils.headerShrink.headerShrink()}))},toggleShowToolsList(){const e=document.querySelector(".side-tools-list");document.querySelector(".tool-toggle-show").addEventListener("click",(t=>{e.classList.toggle("show"),t.stopPropagation()})),e.querySelectorAll(".tools-item").forEach((e=>{e.addEventListener("click",(e=>{e.stopPropagation()}))})),document.addEventListener("click",(()=>{e.classList.contains("show")&&e.classList.remove("show")}))},globalFontAdjust(){const e=document.defaultView.getComputedStyle(document.body).fontSize,t=parseFloat(e),o=e=>{this.html_root_dom.style.fontSize=t*(1+.05*e)+"px",KEEP.styleStatus.fontSizeLevel=e,KEEP.setStyleStatus()};(()=>{const e=KEEP.getStyleStatus();e&&(this.fontSizeLevel=e.fontSizeLevel,o(this.fontSizeLevel))})(),document.querySelector(".tool-font-adjust-plus").addEventListener("click",(()=>{5!==this.fontSizeLevel&&(this.fontSizeLevel++,o(this.fontSizeLevel))})),document.querySelector(".tool-font-adjust-minus").addEventListener("click",(()=>{this.fontSizeLevel<=0||(this.fontSizeLevel--,o(this.fontSizeLevel))}))},getElementHeight(e){const t=document.querySelector(e);return t?t.getBoundingClientRect().height:0},initHasToc(){document.querySelectorAll(".post-toc-wrap .post-toc li").length>0?(this.hasToc=!0,document.body.classList.add("has-toc")):(this.hasToc=!1,document.body.classList.remove("has-toc"))},initPageHeightHandle(){if(this.firstScreen_dom)return;const e=this.getElementHeight(".page-main-content-top")+this.getElementHeight(".page-main-content-middle")+this.getElementHeight(".page-main-content-bottom"),t=window.innerHeight,o=document.querySelector(".page-main-content-bottom");if(e<t){const s=Math.floor(t-e);s>0&&(o.style.marginTop=s-2+"px")}},zoomInImage(){let e=40,t=!1,o=0,s=null;const r=document.querySelectorAll(".keep-markdown-body img"),i=document.querySelector(".zoom-in-image-mask"),a=i.querySelector(".zoom-in-image"),n=()=>{t&&(t=!1,o=0,a&&(a.style.transform="scale(1)"),i&&i.classList.remove("show"),setTimeout((()=>{s&&s.classList.remove("hide")}),300))};r.length&&(i&&i.addEventListener("click",(()=>{n()})),document.addEventListener("scroll",(()=>{t&&Math.abs(o-window.scrollY)>=50&&n()})),r.forEach((r=>{r.addEventListener("click",(()=>{if(o=window.scrollY,t=!t,(()=>{const t=document.body.offsetWidth;e=t<=500?10:t<=800?20:40})(),a.setAttribute("src",r.getAttribute("src")),s=r,t){const t=s.getBoundingClientRect(),o=t.width,r=t.height,n=t.left,l=t.top,c=document.body.offsetWidth-2*e,d=document.body.offsetHeight-2*e,h=c/o,g=d/r,m=(h<g?h:g)||1,u=c/2-(t.x+o/2)+e,p=d/2-(t.y+r/2)+e;s.classList.add("hide"),i.classList.add("show"),a.style.top=l+"px",a.style.left=n+"px",a.style.width=o+"px",a.style.height=r+"px",a.style.transform=`translateX(${u}px) translateY(${p}px) scale(${m}) `}}))})))},setHowLongAgoLanguage:(e,t)=>t.replace(/%s/g,e),getHowLongAgo(e){const t=KEEP.language_ago,o=Math.floor(e/2592e3/12),s=Math.floor(e/2592e3),r=Math.floor(e/86400/7),i=Math.floor(e/86400),a=Math.floor(e/3600%24),n=Math.floor(e/60%60),l=Math.floor(e%60);return o>0?this.setHowLongAgoLanguage(o,t.year):s>0?this.setHowLongAgoLanguage(s,t.month):r>0?this.setHowLongAgoLanguage(r,t.week):i>0?this.setHowLongAgoLanguage(i,t.day):a>0?this.setHowLongAgoLanguage(a,t.hour):n>0?this.setHowLongAgoLanguage(n,t.minute):l>0?this.setHowLongAgoLanguage(l,t.second):void 0},setHowLongAgoInHome(){const e=document.querySelectorAll(".home-article-meta-info .home-article-date");e&&e.forEach((e=>{const t=Date.now(),o=new Date(e.dataset.updated.split(" GMT")[0]).getTime();e.innerHTML=this.getHowLongAgo(Math.floor((t-o)/1e3))}))},pjaxProgressBarStart(){this.pjaxProgressBarTimer&&clearInterval(this.pjaxProgressBarTimer),this.isHasScrollProgressBar&&this.scrollProgressBar_dom.classList.add("hide"),this.pjaxProgressBar_dom.style.width="0",this.pjaxProgressIcon_dom.classList.add("show");let e=1;this.pjaxProgressBar_dom.classList.add("show"),this.pjaxProgressBar_dom.style.width=e+"%",this.pjaxProgressBarTimer=setInterval((()=>{e+=5,e>99&&(e=99),this.pjaxProgressBar_dom.style.width=e+"%"}),100)},pjaxProgressBarEnd(){this.pjaxProgressBarTimer&&clearInterval(this.pjaxProgressBarTimer),this.pjaxProgressBar_dom.style.width="100%";const e=setTimeout((()=>{this.pjaxProgressBar_dom.classList.remove("show"),this.pjaxProgressIcon_dom.classList.remove("show"),this.isHasScrollProgressBar&&this.scrollProgressBar_dom.classList.remove("hide");const t=setTimeout((()=>{this.pjaxProgressBar_dom.style.width="0",clearTimeout(e),clearTimeout(t)}),200)}),200)},insertTooltipContent(){const e=()=>{document.querySelectorAll(".tooltip").forEach((e=>{const{content:t,offsetX:o,offsetY:s}=e.dataset;let r="",i="",a="";o&&(i=`left: ${o};`),s&&(a=`top: ${s};`),(o||s)&&(r=` style="${a}${i}"`),t&&e.insertAdjacentHTML("afterbegin",`<span class="tooltip-content"${r}>${t}</span>`)}));const e={};document.querySelectorAll(".tooltip-img").forEach(((t,o)=>{const{imgUrl:s,name:r}=t.dataset;if(s){const i=`tooltip-img-${r}`,a=`${r}_${o}`,n=`<div class="tooltip-img-box">${`<img class="${i}" lazyload data-src="${s}" alt="${r}">`}</div>`;e[a]={imgLoaded:!1,isShowImg:!1},t.insertAdjacentHTML("afterbegin",n),t.addEventListener("click",(o=>{e[a].imgLoaded||((e,t)=>{const o=new Image,{src:s}=e.dataset;o.src=s,o.onload=()=>{e.src=s,e.removeAttribute("lazyload")}})(document.querySelector(`.tooltip-img-box img.${i}`),e[a].imgLoaded),e[a].isShowImg=!e[a].isShowImg,t.classList.toggle("show-img"),o.stopPropagation()})),((t,o)=>{document.addEventListener("click",(()=>{e[o].isShowImg&&(t.classList.remove("show-img"),e[o].isShowImg=!1)}))})(t,a)}}))};setTimeout((()=>{e()}),1e3)}},KEEP.utils.initData(),KEEP.utils.registerWindowScroll(),KEEP.utils.toggleShowToolsList(),KEEP.utils.globalFontAdjust(),KEEP.utils.initPageHeightHandle(),KEEP.utils.initHasToc(),KEEP.utils.zoomInImage(),KEEP.utils.setHowLongAgoInHome(),KEEP.utils.insertTooltipContent()};